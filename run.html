<!DOCTYPE html>
<html lang="en">
  <head>
    <title>‚öê Bender runtime</title>
    <meta charset="UTF-8">
    <style>
      html, body { height: 100%; }
      body, svg { margin: 0; padding: 0; }
    </style>
    <script src="flexo.js"></script>
    <script src="bender.js"></script>
  </head>
  <body>
    <script>

      // Get args from the URL
      function get_args(argstr)
      {
        var args = { target: "bender-target", debug: 0 };
        if (!argstr) {
          argstr =  typeof window === "object" &&
            typeof window.location === "object" &&
            typeof window.location.search === "string" ?
            window.location.search.substring(1) : "";
        }
        argstr.split("&").forEach(function(q) {
            var sep = q.indexOf("=");
            args[q.substr(0, sep)] = unescape(q.substr(sep + 1));
          });
        bender.DEBUG_LEVEL = args.debug;
        return args;
      }

      // Open a file from a URL
      function open_url(args)
      {
        flexo.request_uri(args.app, function(req) {
            document.body.innerHTML = "";
            var context = bender.create_context(document);
            var app = context.import(req.responseXML.documentElement);
            bender.listen(app, "@loaded", function() {
                var instance = app.instantiate();
                if (instance.render(document.body, true)) {
                  for (var a in args) {
                    if (args.hasOwnProperty(a)) {
                      if (a.substr(0, 2) === "e:") {
                        prop_name = "$" + flexo.undash(a.substr(2));
                        instance[prop_name] = args[a];
                      } else if (a.substr(0, 2) === "f:") {
                        prop_name = "$" + flexo.undash(a.substr(2));
                        instance[prop_name] = parseFloat(args[a]);
                      } else if (a.substr(0, 2) === "b:") {
                        prop_name = "$" + flexo.undash(a.substr(2));
                        instance[prop_name] = bender.is_true(args[a]);
                      } else if (a.substr(0, 1) === "$") {
                        instance[a] = args[a];
                      }
                    }
                  }
                  bender.notify(instance, "@ready");
                }
              });
          });
      }

      var ARGS = get_args();
      if (ARGS.app) open_url(ARGS);

    </script>
  </body>
</html>
