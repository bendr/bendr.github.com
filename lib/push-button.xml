<component xmlns="http://bender.igel.co.jp" xmlns:b="http://bender.igel.co.jp/b"
  xmlns:e="http://bender.igel.co.jp/e" xmlns:f="http://bender.igel.co.jp/f"
  xmlns:html="http://www.w3.org/1999/xhtml"
  b:enabled="true" f:tabindex="0" e:class="" id="button">

  <title>An HTML button component that responds to both mouse and touch
    events</title>

  <stylesheet>
    .bender-button { display: inline-block; cursor: default;
      padding: .3em .5em; background-color:#ddd; -moz-border-radius: 6px;
      -webkit-border-radius: 6px; border-radius: 6px;
      box-shadow: 0px 1px 0px #ccc; text-shadow: 0px 1px 0px #fff; }
    .bender-button.__disabled, .bender-button.__down { opacity: 0.5; }
    .bender-naked .bender-button { padding: 0; border: none;
      background-color: transparent; text-shadow: 0px 0px 0px; }
  </stylesheet>

  <view>
    <html:div id="b" aria-role="button">
      <content/>
    </html:div>
  </view>

  <local-script>
    // Simulate a push of the button
    prototype.push = function()
    {
      var self = this;
      flexo.add_class(self.views.b, "__down");
      setTimeout(function() {
          flexo.remove_class(self.views.b, "__down");
          setTimeout(function() { bender.notify(self, "@pushed"); }, 0);
        }, 100);
    };
  </local-script>

  <watch>
    <get property="enabled">
      flexo.set_class_iff(this.views.b, "__disabled", !value);
      if (!value) {
        this.__tabindex = this.tabindex;
        this.tabindex = -1;
      } else if (this.hasOwnProperty("__tabindex")) {
        this.tabindex = this.__tabindex;
        delete this.__tabindex;
      }
    </get>
  </watch>

  <watch>
    <get property="tabindex"/>
    <set view="b" attr="tabindex"/>
  </watch>

  <watch>
    <get view="b" dom-event="mousedown">
      if (value.button === 0) {
        value.preventDefault();
        if (this.$enabled) flexo.add_class(this.views.b, "__down");
      }
    </get>
    <watch>
      <get view="b" dom-event="mouseup" once="true">
        if (flexo.remove_class(this.views.b, "__down")) {
          setTimeout((function() {
              bender.notify(this, "@pushed");
            }).bind(this), 0);
        }
      </get>
    </watch>
    <watch>
      <get dom-event="mouseup" once="true">
        flexo.remove_class(this.views.b, "__down");
      </get>
    </watch>
  </watch>

  <watch>
    <get view="b" dom-event="keydown">
      if (this.$enabled) {
        if (value.keyCode === 13) {
          value.preventDefault();
          this.push();
        } else if (value.keyCode === 27) {
          value.preventDefault();
          this.views.b.blur();
        }
      }
    </get>
  </watch>

  <watch>
    <get property="class"/>
    <set view="b" attr="class">
      return "bender-button {0}".fmt(value);
    </set>
  </watch>

</component>
